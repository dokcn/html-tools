<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>嵌入式原理图符号大全 - 终极指南</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .component-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .component-card:hover { transform: translateY(-4px); box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1); border-color: #3b82f6; }
        
        .sidebar-link.active { background-color: #eff6ff; color: #1d4ed8; border-right: 3px solid #2563eb; }
        
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Schematic Symbols */
        .sch-symbol { stroke: currentColor; stroke-width: 2.5; fill: none; stroke-linecap: round; stroke-linejoin: round; }
        .sch-fill { fill: currentColor; stroke: none; }
        .sch-text { font-family: monospace; font-size: 14px; font-weight: bold; fill: currentColor; stroke: none; }
        .sch-text-sm { font-family: monospace; font-size: 10px; fill: currentColor; stroke: none; }
        
        /* Polarity Markers (Hidden by default) */
        .marker-pos, .marker-neg { opacity: 0; transition: opacity 0.3s; stroke: none; }
        .marker-pos { fill: #ef4444; } /* Red */
        .marker-neg { fill: #3b82f6; } /* Blue */
        
        /* Show polarity when active */
        .show-polarity .marker-pos, .show-polarity .marker-neg { opacity: 1; }
        .show-polarity .marker-pos { animation: pulse-red 2s infinite; }
        .show-polarity .marker-neg { animation: pulse-blue 2s infinite; }
        
        @keyframes pulse-red { 0% { r:3; opacity:0.6; } 50% { r:5; opacity:1; } 100% { r:3; opacity:0.6; } }
        @keyframes pulse-blue { 0% { r:3; opacity:0.6; } 50% { r:5; opacity:1; } 100% { r:3; opacity:0.6; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">
    
<header class="bg-white border-b border-slate-200 h-16 flex-none z-30 shadow-sm">
    <div class="h-full px-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 text-white p-1.5 rounded-lg">
                <span class="material-symbols-outlined text-2xl">menu_book</span>
            </div>
            <div>
                <h1 class="text-xl font-bold text-slate-900 leading-tight">EDA 原理图符号大全</h1>
                <p class="text-xs text-slate-500 hidden sm:block">嵌入式硬件工程师必备手册</p>
            </div>
        </div>
        <div class="flex-1 max-w-xl mx-4 relative hidden md:block">
            <span class="material-symbols-outlined absolute left-3 top-2.5 text-slate-400">search</span>
            <input class="w-full pl-10 pr-4 py-2 bg-slate-100 border-transparent focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-100 rounded-lg text-sm transition-all outline-none" id="search-input" onkeyup="handleSearch()" placeholder="搜索元器件 (如: R, MOS, 二极管)..." type="text">
        </div>
        <div class="flex gap-2">
            <button class="px-3 py-1.5 rounded-lg border border-slate-200 text-slate-600 text-xs font-bold hover:bg-slate-50 flex items-center gap-2 transition-all" id="btn-polarity-toggle" onclick="togglePolarityMode()">
                <span class="material-symbols-outlined text-lg">battery_charging_full</span>
                <span id="polarity-btn-text">显示极性</span>
            </button>
        </div>
    </div>
</header>

<div class="flex flex-1 overflow-hidden relative">
    <aside class="w-64 bg-white border-r border-slate-200 flex-col hidden md:flex overflow-y-auto z-20">
        <div class="p-4">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">分类索引</h3>
            <nav class="space-y-1" id="category-nav"></nav>
        </div>
        <div class="mt-auto p-4 border-t border-slate-100 bg-slate-50">
            <div class="bg-blue-50 rounded-lg p-3 border border-blue-100">
                <div class="flex items-start gap-2">
                    <span class="material-symbols-outlined text-blue-600 text-lg">info</span>
                    <div>
                        <p class="text-xs text-blue-800 font-bold mb-1">提示</p>
                        <p class="text-[10px] text-blue-600 leading-relaxed">点击右上角“显示极性”可查看正负极（红正蓝负）。</p>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-4 md:p-8 relative scroll-smooth bg-slate-50/50" id="main-content">
        <div class="md:hidden mb-6 sticky top-0 z-10 bg-slate-50 pt-2 pb-4">
            <div class="relative">
                <span class="material-symbols-outlined absolute left-3 top-3 text-slate-400">search</span>
                <input class="w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100" id="search-input-mobile" onkeyup="handleSearchMobile()" placeholder="搜索元器件..." type="text">
            </div>
        </div>

        <div class="space-y-10 pb-20" id="content-grid"></div>

        <div class="hidden flex flex-col items-center justify-center py-20 text-center" id="no-results">
            <span class="material-symbols-outlined text-6xl text-slate-200 mb-4">search_off</span>
            <p class="text-slate-500 font-medium">没有找到匹配的元器件</p>
            <button class="mt-4 text-blue-600 text-sm hover:underline" onclick="resetSearch()">清除搜索</button>
        </div>
    </main>
</div>

<div aria-labelledby="modal-title" aria-modal="true" class="fixed inset-0 z-50 hidden" id="modal" role="dialog">
    <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
    <div class="fixed inset-0 z-10 overflow-y-auto pointer-events-none">
        <div class="flex min-h-full items-center justify-center p-4 text-center pointer-events-auto">
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all w-full max-w-4xl border border-slate-200 flex flex-col md:flex-row max-h-[90vh]">
                <button class="absolute top-4 right-4 z-20 p-2 bg-white/50 hover:bg-white rounded-full text-slate-500 hover:text-slate-800 transition-colors" onclick="closeModal()">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="w-full md:w-5/12 bg-slate-50 border-r border-slate-200 p-6 flex flex-col items-center justify-center shrink-0">
                    <div class="w-full aspect-square bg-white rounded-xl border border-slate-200 shadow-sm flex items-center justify-center p-8 mb-4 relative overflow-hidden group">
                        <div class="w-full h-full text-slate-800 transition-transform duration-300 group-hover:scale-105" id="modal-svg"></div>
                        <div class="absolute bottom-2 left-0 right-0 text-center text-[10px] text-slate-400">原理图符号</div>
                    </div>
                    <div class="w-full h-32 bg-white rounded-lg relative overflow-hidden group cursor-pointer border border-slate-200 flex items-center justify-center" title="实物示意图">
                        <img alt="Real Component" class="h-full object-contain p-2 transition-transform duration-300 group-hover:scale-110" id="modal-img" src="">
                        <div class="absolute bottom-0 left-0 bg-black/60 text-white text-[10px] px-2 py-0.5 rounded-tr">实物参考</div>
                    </div>
                </div>
                <div class="w-full md:w-7/12 p-8 overflow-y-auto">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="font-mono font-bold text-base px-2 py-1 bg-slate-100 rounded text-slate-600 border border-slate-200" id="modal-refdes"></span>
                        <h2 class="text-3xl font-bold text-slate-900" id="modal-title"></h2>
                    </div>
                    <div class="flex gap-2 mb-6">
                        <span class="text-xs font-bold uppercase tracking-wider text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full border border-blue-100" id="modal-cat"></span>
                        <span class="text-xs font-bold uppercase tracking-wider px-2 py-0.5 rounded-full border" id="modal-pol-badge"></span>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <h4 class="flex items-center gap-2 text-xs font-bold text-slate-900 uppercase tracking-wide mb-2"><span class="material-symbols-outlined text-sm text-blue-500">settings_ethernet</span> 功能与作用</h4>
                            <p class="text-base text-slate-600 leading-relaxed" id="modal-desc"></p>
                        </div>
                        <div class="bg-amber-50 rounded-lg p-4 border border-amber-100" id="modal-polarity-box">
                            <h4 class="flex items-center gap-2 text-xs font-bold text-amber-800 uppercase tracking-wide mb-2"><span class="material-symbols-outlined text-sm">battery_charging_full</span> 极性识别 (关键)</h4>
                            <p class="text-base text-amber-900 leading-relaxed" id="modal-polarity-text"></p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div class="text-xs text-slate-400 uppercase font-bold mb-1">常见参数单位</div>
                                <div class="text-base font-mono font-medium text-slate-700" id="modal-unit"></div>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div class="text-xs text-slate-400 uppercase font-bold mb-1">常见封装</div>
                                <div class="text-base font-mono font-medium text-slate-700" id="modal-pkg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. Realistic SVG Illustrations (Data URIs) ---
    // 实物示意图
    const REAL_IMGS = {
        resistor: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'><line x1='0' y1='30' x2='100' y2='30' stroke='%239ca3af' stroke-width='4'/><rect x='20' y='15' width='60' height='30' rx='5' fill='%23f5d0a9' stroke='%23d97706' stroke-width='1'/><rect x='30' y='15' width='5' height='30' fill='%23a16207'/><rect x='45' y='15' width='5' height='30' fill='%23000000'/><rect x='60' y='15' width='5' height='30' fill='%23dc2626'/><rect x='75' y='15' width='5' height='30' fill='%23d4af37'/></svg>",
        cap_pol: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 80'><rect x='15' y='20' width='30' height='50' rx='2' fill='%231e293b'/><rect x='10' y='25' width='5' height='40' fill='%2394a3b8'/><line x1='20' y1='80' x2='20' y2='20' stroke='%239ca3af' stroke-width='2'/><line x1='40' y1='80' x2='40' y2='20' stroke='%239ca3af' stroke-width='2'/><circle cx='30' cy='20' r='15' fill='%23334155' stroke='%2394a3b8' stroke-width='1'/><text x='15' y='50' fill='white' font-family='sans-serif' font-size='6' transform='rotate(-90 15,50)'>100uF</text></svg>",
        diode: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 40'><line x1='0' y1='20' x2='100' y2='20' stroke='%239ca3af' stroke-width='4'/><rect x='20' y='10' width='60' height='20' rx='2' fill='%23ef4444'/><rect x='25' y='10' width='15' height='20' fill='%231f2937'/><rect x='70' y='10' width='5' height='20' fill='%231f2937'/></svg>",
        led: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 80'><path d='M30,10 C40,10 50,20 50,35 L50,45 L10,45 L10,35 C10,20 20,10 30,10 Z' fill='%23ef4444' opacity='0.8'/><rect x='10' y='45' width='40' height='5' fill='%23ef4444'/><line x1='25' y1='50' x2='25' y2='80' stroke='%239ca3af' stroke-width='3'/><line x1='35' y1='50' x2='35' y2='70' stroke='%239ca3af' stroke-width='3'/></svg>",
        transistor: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 80'><path d='M15,10 L45,10 C50,10 55,15 55,40 C55,65 50,70 45,70 L15,70 Z' fill='%231f2937'/><rect x='15' y='10' width='5' height='60' fill='%23374151'/><line x1='20' y1='70' x2='20' y2='85' stroke='%239ca3af' stroke-width='3'/><line x1='30' y1='70' x2='30' y2='85' stroke='%239ca3af' stroke-width='3'/><line x1='40' y1='70' x2='40' y2='85' stroke='%239ca3af' stroke-width='3'/><text x='25' y='45' fill='white' font-family='monospace' font-size='8'>2N</text></svg>",
        ic: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 80'><rect x='20' y='10' width='40' height='60' fill='%231f2937' rx='2'/><circle cx='25' cy='15' r='2' fill='%234b5563'/><g stroke='%239ca3af' stroke-width='3'><line x1='15' y1='20' x2='20' y2='20'/><line x1='15' y1='30' x2='20' y2='30'/><line x1='15' y1='40' x2='20' y2='40'/><line x1='15' y1='50' x2='20' y2='50'/><line x1='15' y1='60' x2='20' y2='60'/><line x1='60' y1='20' x2='65' y2='20'/><line x1='60' y1='30' x2='65' y2='30'/><line x1='60' y1='40' x2='65' y2='40'/><line x1='60' y1='50' x2='65' y2='50'/><line x1='60' y1='60' x2='65' y2='60'/></g><text x='30' y='45' fill='white' font-family='monospace' font-size='10'>IC</text></svg>",
        switch: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 60'><rect x='15' y='20' width='30' height='20' fill='%239ca3af'/><circle cx='30' cy='30' r='8' fill='%231f2937'/><rect x='10' y='25' width='5' height='10' fill='%231f2937'/><rect x='45' y='25' width='5' height='10' fill='%231f2937'/><line x1='10' y1='30' x2='0' y2='30' stroke='%239ca3af' stroke-width='2'/><line x1='50' y1='30' x2='60' y2='30' stroke='%239ca3af' stroke-width='2'/></svg>",
        connector: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 40'><rect x='10' y='15' width='60' height='10' fill='%231f2937'/><rect x='15' y='10' width='2' height='5' fill='%23d4af37'/><rect x='25' y='10' width='2' height='5' fill='%23d4af37'/><rect x='35' y='10' width='2' height='5' fill='%23d4af37'/><rect x='45' y='10' width='2' height='5' fill='%23d4af37'/><rect x='55' y='10' width='2' height='5' fill='%23d4af37'/><rect x='65' y='10' width='2' height='5' fill='%23d4af37'/></svg>",
        battery: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 60'><circle cx='30' cy='30' r='25' fill='%23e5e7eb' stroke='%239ca3af' stroke-width='2'/><text x='30' y='35' text-anchor='middle' font-size='8' fill='%23374151'>CR2032</text><text x='30' y='20' text-anchor='middle' font-size='12' fill='%23374151'>+</text></svg>"
    };

    // --- 2. Database ---
    const components = [
        { id: 'resistor', name: '电阻器', en: 'Resistor', ref: 'R', cat: 'passive', pol: false, desc: '限制电流、分压。无极性。', polText: '无极性', unit: 'Ω', pkg: '0603', img: REAL_IMGS.resistor },
        { id: 'potentiometer', name: '电位器', en: 'Potentiometer', ref: 'RP', cat: 'passive', pol: false, desc: '阻值可调。', polText: '无极性', unit: 'kΩ', pkg: 'DIP', img: REAL_IMGS.resistor },
        { id: 'cap_np', name: '陶瓷电容', en: 'Ceramic Cap', ref: 'C', cat: 'passive', pol: false, desc: '高频滤波。无极性。', polText: '无极性', unit: 'nF', pkg: '0402', img: REAL_IMGS.resistor },
        { id: 'cap_pol', name: '电解/钽电容', en: 'Electrolytic Cap', ref: 'C', cat: 'passive', pol: true, desc: '低频滤波、储能。有极性。', polText: '直板/长脚为正，弯板/短脚为负。', unit: 'uF', pkg: 'Can', img: REAL_IMGS.cap_pol },
        { id: 'inductor', name: '电感器', en: 'Inductor', ref: 'L', cat: 'passive', pol: false, desc: '电源滤波。', polText: '无极性', unit: 'uH', pkg: 'CD32', img: REAL_IMGS.resistor },
        { id: 'fuse', name: '保险丝', en: 'Fuse', ref: 'F', cat: 'passive', pol: false, desc: '过流保护。', polText: '无极性', unit: 'A', pkg: '1206', img: REAL_IMGS.resistor },
        
        { id: 'diode', name: '二极管', en: 'Diode', ref: 'D', cat: 'diode', pol: true, desc: '单向导电。', polText: '三角形侧为正，挡板侧为负。', unit: 'V', pkg: 'SMA', img: REAL_IMGS.diode },
        { id: 'zener', name: '稳压二极管', en: 'Zener Diode', ref: 'ZD', cat: 'diode', pol: true, desc: '稳压。反向工作。', polText: '带拐钩挡板为负。', unit: 'Vz', pkg: 'LL34', img: REAL_IMGS.diode },
        { id: 'schottky', name: '肖特基二极管', en: 'Schottky', ref: 'D', cat: 'diode', pol: true, desc: '高速整流。', polText: 'S形挡板为负。', unit: 'V', pkg: 'SMB', img: REAL_IMGS.diode },
        { id: 'led', name: 'LED', en: 'LED', ref: 'D', cat: 'diode', pol: true, desc: '发光。', polText: '三角形侧为正。', unit: 'nm', pkg: '0603', img: REAL_IMGS.led },
        { id: 'bridge', name: '整流桥', en: 'Bridge Rect', ref: 'BR', cat: 'diode', pol: true, desc: 'AC转DC。', polText: '输入AC无极性，输出分正负。', unit: 'V', pkg: 'SOP4', img: REAL_IMGS.ic },

        { id: 'npn', name: 'NPN 三极管', en: 'BJT NPN', ref: 'Q', cat: 'transistor', pol: true, desc: '开关/放大。', polText: '箭头朝外为发射极(E)。', unit: 'hFE', pkg: 'SOT23', img: REAL_IMGS.transistor },
        { id: 'pnp', name: 'PNP 三极管', en: 'BJT PNP', ref: 'Q', cat: 'transistor', pol: true, desc: '开关/放大。', polText: '箭头朝里为发射极(E)。', unit: 'hFE', pkg: 'SOT23', img: REAL_IMGS.transistor },
        { id: 'nmos', name: 'NMOS', en: 'N-Ch MOSFET', ref: 'Q', cat: 'transistor', pol: true, desc: '电压控制开关。', polText: '箭头朝内，GDS引脚对应。', unit: 'Rds', pkg: 'TO220', img: REAL_IMGS.transistor },
        { id: 'pmos', name: 'PMOS', en: 'P-Ch MOSFET', ref: 'Q', cat: 'transistor', pol: true, desc: '电压控制开关。', polText: '箭头朝外，GDS引脚对应。', unit: 'Rds', pkg: 'SOT23', img: REAL_IMGS.transistor },

        { id: 'battery', name: '电池', en: 'Battery', ref: 'BT', cat: 'power', pol: true, desc: '电源。', polText: '长线正，短粗线负。', unit: 'V', pkg: 'CR2032', img: REAL_IMGS.battery },
        { id: 'vcc', name: 'VCC', en: 'Power', ref: 'VCC', cat: 'power', pol: true, desc: '正电源。', polText: '正极', unit: 'V', pkg: '-', img: REAL_IMGS.connector },
        { id: 'gnd', name: 'GND', en: 'Ground', ref: 'GND', cat: 'power', pol: false, desc: '地。', polText: '-', unit: '0V', pkg: '-', img: REAL_IMGS.connector },
        
        { id: 'switch', name: '开关', en: 'Switch', ref: 'SW', cat: 'conn', pol: false, desc: '通断控制。', polText: '无极性', unit: '-', pkg: 'Tactile', img: REAL_IMGS.switch },
        { id: 'connector', name: '排针', en: 'Header', ref: 'J', cat: 'conn', pol: true, desc: '连接。', polText: 'Pin 1有方块标记。', unit: '-', pkg: '2.54', img: REAL_IMGS.connector },
        { id: 'mcu', name: 'MCU', en: 'Microcontroller', ref: 'U', cat: 'ic', pol: true, desc: '主控。', polText: 'Pin 1有圆点。', unit: 'MHz', pkg: 'LQFP', img: REAL_IMGS.ic },
        { id: 'opamp', name: '运放', en: 'OpAmp', ref: 'U', cat: 'ic', pol: true, desc: '放大。', polText: '注意V+/V-电源。', unit: 'GBW', pkg: 'SOP8', img: REAL_IMGS.ic }
    ];

    const categories = { 'all': '全部显示', 'passive': '阻容感', 'diode': '二极管', 'transistor': '晶体管', 'power': '电源', 'conn': '连接器', 'ic': '芯片' };

    // --- 3. Refined SVG Symbols (With Markers & Better Layout) ---
    const svgs = {
        // 无极性
        resistor: '<path class="sch-symbol" d="M0,45 L20,45 L25,30 L35,60 L45,30 L55,60 L65,30 L75,60 L80,45 L100,45"/>',
        potentiometer: '<path class="sch-symbol" d="M0,45 L20,45 L25,30 L35,60 L45,30 L55,60 L65,30 L75,60 L80,45 L100,45"/><path class="sch-symbol" d="M50,20 L50,35"/><path class="sch-fill" d="M50,42 L45,32 L55,32 Z"/>',
        cap_np: '<line class="sch-symbol" x1="0" y1="45" x2="42" y2="45"/><line class="sch-symbol" x1="42" y1="25" x2="42" y2="65"/><line class="sch-symbol" x1="58" y1="25" x2="58" y2="65"/><line class="sch-symbol" x1="58" y1="45" x2="100" y2="45"/>',
        inductor: '<path class="sch-symbol" d="M0,45 L20,45 Q30,15 40,45 Q50,15 60,45 Q70,15 80,45 L100,45"/>',
        fuse: '<line class="sch-symbol" x1="0" y1="45" x2="20" y2="45"/><path class="sch-symbol" d="M20,45 Q35,25 50,45 Q65,65 80,45"/><rect class="sch-symbol" x="20" y="30" width="60" height="30"/><line class="sch-symbol" x1="80" y1="45" x2="100" y2="45"/>',
        switch: '<line class="sch-symbol" x1="10" y1="55" x2="35" y2="55"/><circle class="sch-symbol" cx="38" cy="55" r="2"/><line class="sch-symbol" x1="38" y1="55" x2="65" y2="35"/><circle class="sch-symbol" cx="65" cy="55" r="2"/><line class="sch-symbol" x1="68" y1="55" x2="90" y2="55"/>',
        gnd: '<line class="sch-symbol" x1="50" y1="25" x2="50" y2="50"/><line class="sch-symbol" x1="30" y1="50" x2="70" y2="50"/><line class="sch-symbol" x1="38" y1="60" x2="62" y2="60"/><line class="sch-symbol" x1="46" y1="70" x2="54" y2="70"/>',

        // 有极性 - 修复了遮挡和标记
        // 1. 电解电容：+号上移避开线，添加红蓝点
        cap_pol: '<line class="sch-symbol" x1="0" y1="45" x2="42" y2="45"/><rect class="sch-fill" x="42" y="25" width="5" height="40"/><path class="sch-symbol" d="M58,25 Q50,45 58,65"/><line class="sch-symbol" x1="58" y1="45" x2="100" y2="45"/><text x="25" y="35" class="sch-text">+</text><circle cx="20" cy="45" r="4" class="marker-pos"/><circle cx="80" cy="45" r="4" class="marker-neg"/>',
        
        // 2. 二极管：添加红蓝点
        diode: '<line class="sch-symbol" x1="0" y1="45" x2="40" y2="45"/><line class="sch-symbol" x1="60" y1="45" x2="100" y2="45"/><path class="sch-symbol" d="M40,30 L40,60 L60,45 Z"/><line class="sch-symbol" x1="60" y1="30" x2="60" y2="60"/><circle cx="20" cy="45" r="4" class="marker-pos"/><circle cx="80" cy="45" r="4" class="marker-neg"/>',
        
        // 3. 稳压二极管：添加红蓝点
        zener: '<line class="sch-symbol" x1="0" y1="45" x2="40" y2="45"/><line class="sch-symbol" x1="60" y1="45" x2="100" y2="45"/><path class="sch-symbol" d="M40,30 L40,60 L60,45 Z"/><polyline class="sch-symbol" points="55,25 60,30 60,60 65,65"/><circle cx="20" cy="45" r="4" class="marker-pos"/><circle cx="80" cy="45" r="4" class="marker-neg"/>',
        
        // 4. 肖特基：添加红蓝点
        schottky: '<line class="sch-symbol" x1="0" y1="45" x2="40" y2="45"/><line class="sch-symbol" x1="60" y1="45" x2="100" y2="45"/><path class="sch-symbol" d="M40,30 L40,60 L60,45 Z"/><polyline class="sch-symbol" points="65,25 60,30 60,60 55,65"/><polyline class="sch-symbol" points="65,25 60,25"/><polyline class="sch-symbol" points="55,65 60,65"/><circle cx="20" cy="45" r="4" class="marker-pos"/><circle cx="80" cy="45" r="4" class="marker-neg"/>',
        
        // 5. LED：添加红蓝点
        led: '<line class="sch-symbol" x1="0" y1="55" x2="40" y2="55"/><line class="sch-symbol" x1="60" y1="55" x2="100" y2="55"/><path class="sch-symbol" d="M40,40 L40,70 L60,55 Z"/><line class="sch-symbol" x1="60" y1="40" x2="60" y2="70"/><line class="sch-symbol" x1="70" y1="40" x2="85" y2="25"/><polyline class="sch-symbol" points="80,25 85,25 85,30"/><line class="sch-symbol" x1="78" y1="43" x2="93" y2="28"/><polyline class="sch-symbol" points="88,28 93,28 93,33"/><circle cx="20" cy="55" r="4" class="marker-pos"/><circle cx="80" cy="55" r="4" class="marker-neg"/>',
        
        // 6. 整流桥：调整文字位置，添加标记
        bridge: '<rect class="sch-symbol" x="30" y="25" width="40" height="40" transform="rotate(45 50 45)"/><text x="43" y="50" class="sch-text">~</text><text x="15" y="50" class="sch-text">+</text><text x="75" y="50" class="sch-text">-</text><circle cx="10" cy="50" r="4" class="marker-pos"/><circle cx="90" cy="50" r="4" class="marker-neg"/>',
        
        // 7. 电池：文字上移，添加标记
        battery: '<line class="sch-symbol" x1="10" y1="45" x2="40" y2="45"/><line class="sch-symbol" x1="40" y1="30" x2="40" y2="60" stroke-width="4"/><line class="sch-symbol" x1="50" y1="37" x2="50" y2="53" stroke-width="4"/><line class="sch-symbol" x1="60" y1="30" x2="60" y2="60" stroke-width="4"/><line class="sch-symbol" x1="70" y1="37" x2="70" y2="53" stroke-width="4"/><line class="sch-symbol" x1="70" y1="45" x2="100" y2="45"/><text x="35" y="25" class="sch-text">+</text><circle cx="20" cy="45" r="4" class="marker-pos"/><circle cx="90" cy="45" r="4" class="marker-neg"/>',
        
        // 8. VCC
        vcc: '<line class="sch-symbol" x1="50" y1="65" x2="50" y2="35"/><polyline class="sch-symbol" points="40,45 50,35 60,45"/><text x="65" y="45" class="sch-text">VCC</text><circle cx="50" cy="35" r="4" class="marker-pos"/>',
        
        // 9. 连接器
        connector: '<rect class="sch-symbol" x="20" y="25" width="60" height="40"/><circle class="sch-fill" cx="30" cy="45" r="3"/><circle class="sch-fill" cx="50" cy="45" r="3"/><circle class="sch-fill" cx="70" cy="45" r="3"/><text x="25" y="60" class="sch-text">1</text><circle cx="15" cy="45" r="4" class="marker-pos"/>',
        
        // 10. MCU
        mcu: '<rect class="sch-symbol" x="15" y="25" width="70" height="40"/><line class="sch-symbol" x1="5" y1="35" x2="15" y2="35"/><line class="sch-symbol" x1="5" y1="45" x2="15" y2="45"/><line class="sch-symbol" x1="25" y1="20" x2="25" y2="25"/><line class="sch-symbol" x1="75" y1="20" x2="75" y2="25"/><text x="30" y="50" class="sch-text">MCU</text><circle cx="10" cy="35" r="4" class="marker-pos"/>',
        
        // 11. OpAmp: 调整文字位置
        opamp: '<polygon class="sch-symbol" points="20,25 20,65 80,45"/><text x="25" y="40" class="sch-text">-</text><text x="25" y="60" class="sch-text">+</text><circle cx="85" cy="45" r="4" class="marker-pos"/>',

        // 12. 三极管/MOS: 不加强制正负极点，因引脚极性视电路而定，保持符号清晰即可
        npn: '<line class="sch-symbol" x1="20" y1="50" x2="40" y2="50"/><line class="sch-symbol" x1="40" y1="30" x2="40" y2="70" stroke-width="4"/><line class="sch-symbol" x1="40" y1="40" x2="65" y2="20"/><line class="sch-symbol" x1="40" y1="60" x2="65" y2="80"/><polyline class="sch-fill" points="65,80 58,75 62,70"/><line class="sch-symbol" x1="65" y1="20" x2="65" y2="10"/><line class="sch-symbol" x1="65" y1="80" x2="65" y2="90"/><text x="70" y="85" class="sch-text">E</text><text x="70" y="20" class="sch-text">C</text><text x="10" y="45" class="sch-text">B</text>',
        pnp: '<line class="sch-symbol" x1="20" y1="50" x2="40" y2="50"/><line class="sch-symbol" x1="40" y1="30" x2="40" y2="70" stroke-width="4"/><line class="sch-symbol" x1="40" y1="40" x2="65" y2="20"/><line class="sch-symbol" x1="40" y1="60" x2="65" y2="80"/><polyline class="sch-fill" points="45,65 40,60 50,60"/><line class="sch-symbol" x1="65" y1="20" x2="65" y2="10"/><line class="sch-symbol" x1="65" y1="80" x2="65" y2="90"/><text x="70" y="85" class="sch-text">C</text><text x="70" y="20" class="sch-text">E</text><text x="10" y="45" class="sch-text">B</text>',
        nmos: '<line class="sch-symbol" x1="20" y1="50" x2="35" y2="50"/><line class="sch-symbol" x1="35" y1="20" x2="35" y2="80"/><line class="sch-symbol" x1="50" y1="20" x2="50" y2="80"/><line class="sch-symbol" x1="35" y1="30" x2="50" y2="30"/><line class="sch-symbol" x1="35" y1="50" x2="50" y2="50"/><line class="sch-symbol" x1="35" y1="70" x2="50" y2="70"/><line class="sch-symbol" x1="50" y1="30" x2="70" y2="30"/><line class="sch-symbol" x1="50" y1="70" x2="70" y2="70"/><line class="sch-symbol" x1="70" y1="30" x2="70" y2="15"/><line class="sch-symbol" x1="70" y1="70" x2="70" y2="85"/><polyline class="sch-fill" points="45,55 50,50 45,45"/><text x="15" y="45" class="sch-text">G</text><text x="75" y="30" class="sch-text">D</text><text x="75" y="75" class="sch-text">S</text>',
        pmos: '<line class="sch-symbol" x1="20" y1="50" x2="35" y2="50"/><line class="sch-symbol" x1="35" y1="20" x2="35" y2="80"/><line class="sch-symbol" x1="50" y1="20" x2="50" y2="80"/><line class="sch-symbol" x1="35" y1="30" x2="50" y2="30"/><line class="sch-symbol" x1="35" y1="50" x2="50" y2="50"/><line class="sch-symbol" x1="35" y1="70" x2="50" y2="70"/><line class="sch-symbol" x1="50" y1="30" x2="70" y2="30"/><line class="sch-symbol" x1="50" y1="70" x2="70" y2="70"/><line class="sch-symbol" x1="70" y1="30" x2="70" y2="15"/><line class="sch-symbol" x1="70" y1="70" x2="70" y2="85"/><circle class="sch-fill" cx="42" cy="50" r="3"/><text x="15" y="45" class="sch-text">G</text><text x="75" y="30" class="sch-text">D</text><text x="75" y="75" class="sch-text">S</text>'
    };

    // --- 4. Logic ---
    let currentFilter = 'all';
    let isPolarityMode = false;

    document.addEventListener('DOMContentLoaded', () => {
        renderSidebar();
        renderContent('all');
    });

    function renderSidebar() {
        const nav = document.getElementById('category-nav');
        nav.innerHTML = '';
        Object.keys(categories).forEach(key => {
            const btn = document.createElement('button');
            btn.className = `w-full text-left px-3 py-2.5 text-sm font-medium rounded-md transition-colors ${key === 'all' ? 'bg-blue-50 text-blue-700 border-r-2 border-blue-600' : 'text-slate-600 hover:bg-slate-50'}`;
            btn.innerText = categories[key];
            btn.onclick = () => {
                renderContent(key);
                Array.from(nav.children).forEach(b => b.className = 'w-full text-left px-3 py-2.5 text-sm font-medium rounded-md transition-colors text-slate-600 hover:bg-slate-50');
                btn.className = 'w-full text-left px-3 py-2.5 text-sm font-medium rounded-md transition-colors bg-blue-50 text-blue-700 border-r-2 border-blue-600';
            };
            nav.appendChild(btn);
        });
    }

    function renderContent(filter) {
        currentFilter = filter;
        const grid = document.getElementById('content-grid');
        grid.innerHTML = '';
        
        const catsToRender = filter === 'all' ? Object.keys(categories).filter(c => c !== 'all') : [filter];
        let hasResults = false;

        catsToRender.forEach(catKey => {
            const items = components.filter(c => c.cat === catKey);
            if (items.length === 0) return;
            hasResults = true;

            const section = document.createElement('section');
            section.className = "animate-fade-in";
            section.innerHTML = `
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 border-b border-slate-200 pb-2">${categories[catKey]}</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    ${items.map(item => createCard(item)).join('')}
                </div>
            `;
            grid.appendChild(section);
        });

        document.getElementById('no-results').classList.toggle('hidden', hasResults);
    }

    function createCard(item) {
        const svgCode = svgs[item.id] || '<text x="10" y="30" class="sch-text">No SVG</text>';
        const polBadge = item.pol ? `<span class="absolute top-2 right-2 w-2 h-2 rounded-full bg-red-500" title="有极性"></span>` : '';
        
        return `
            <div onclick="openModal('${item.id}')" class="component-card bg-white rounded-xl border border-slate-200 p-4 cursor-pointer relative group">
                ${polBadge}
                <div class="w-full h-28 flex items-center justify-center text-slate-700 mb-2 ${isPolarityMode && item.pol ? 'show-polarity' : ''}">
                    <svg viewBox="0 0 100 90" class="w-full h-full">${svgCode}</svg>
                </div>
                <div class="text-center">
                    <h4 class="font-bold text-base text-slate-900 truncate">${item.name.split(' ')[0]}</h4>
                    <p class="text-xs text-slate-400 font-mono mt-0.5">${item.ref} | ${item.en}</p>
                </div>
            </div>
        `;
    }

    function togglePolarityMode() {
        isPolarityMode = !isPolarityMode;
        const btn = document.getElementById('btn-polarity-toggle');
        const txt = document.getElementById('polarity-btn-text');
        
        if (isPolarityMode) {
            btn.classList.add('bg-red-50', 'text-red-600', 'border-red-200');
            btn.classList.remove('text-slate-600', 'border-slate-200');
            txt.innerText = "极性高亮中";
            document.querySelectorAll('.component-card .w-full.h-28').forEach(el => el.classList.add('show-polarity'));
        } else {
            btn.classList.remove('bg-red-50', 'text-red-600', 'border-red-200');
            btn.classList.add('text-slate-600', 'border-slate-200');
            txt.innerText = "显示极性";
            document.querySelectorAll('.component-card .w-full.h-28').forEach(el => el.classList.remove('show-polarity'));
        }
    }

    function openModal(id) {
        try {
            const item = components.find(c => c.id === id);
            if (!item) return;

            document.getElementById('modal-title').innerText = item.name;
            document.getElementById('modal-refdes').innerText = item.ref;
            document.getElementById('modal-cat').innerText = categories[item.cat];
            
            const polBadge = document.getElementById('modal-pol-badge');
            polBadge.innerText = item.pol ? '⚠️ 有极性' : '无极性';
            polBadge.className = item.pol 
                ? 'text-xs font-bold uppercase tracking-wider px-2 py-0.5 rounded-full bg-red-100 text-red-700 border border-red-200'
                : 'text-xs font-bold uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-100 text-slate-500 border border-slate-200';

            document.getElementById('modal-desc').innerText = item.desc;
            document.getElementById('modal-polarity-text').innerText = item.polText;
            document.getElementById('modal-polarity-box').className = item.pol 
                ? "bg-amber-50 rounded-lg p-4 border border-amber-100" 
                : "bg-slate-50 rounded-lg p-4 border border-slate-100 opacity-75";

            document.getElementById('modal-unit').innerText = item.unit;
            document.getElementById('modal-pkg').innerText = item.pkg;

            const svgCode = svgs[item.id] || '';
            const svgClass = item.pol ? 'show-polarity' : '';
            document.getElementById('modal-svg').innerHTML = `<svg viewBox="0 0 100 90" class="w-full h-full ${svgClass}">${svgCode}</svg>`;
            document.getElementById('modal-img').src = item.img || REAL_IMGS.resistor;
            document.getElementById('modal').classList.remove('hidden');
        } catch (e) {
            console.error("Error opening modal:", e);
        }
    }

    function closeModal() {
        document.getElementById('modal').classList.add('hidden');
    }

    function handleSearch() {
        const term = document.getElementById('search-input').value.toLowerCase();
        performSearch(term);
    }

    function handleSearchMobile() {
        const term = document.getElementById('search-input-mobile').value.toLowerCase();
        performSearch(term);
    }

    function performSearch(term) {
        const grid = document.getElementById('content-grid');
        if (term.length === 0) { renderContent(currentFilter); return; }
        grid.innerHTML = '';
        const results = components.filter(c => c.name.toLowerCase().includes(term) || c.en.toLowerCase().includes(term) || c.ref.toLowerCase().includes(term));
        if (results.length > 0) {
            const section = document.createElement('div');
            section.className = "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 animate-fade-in";
            section.innerHTML = results.map(item => createCard(item)).join('');
            grid.appendChild(section);
            document.getElementById('no-results').classList.add('hidden');
        } else {
            document.getElementById('no-results').classList.remove('hidden');
        }
    }

    function resetSearch() {
        document.getElementById('search-input').value = '';
        if(document.getElementById('search-input-mobile')) document.getElementById('search-input-mobile').value = '';
        renderContent(currentFilter);
        document.getElementById('no-results').classList.add('hidden');
    }

    document.onkeydown = function(evt) { if (evt.key === "Escape") closeModal(); };
</script>
</body>
</html>